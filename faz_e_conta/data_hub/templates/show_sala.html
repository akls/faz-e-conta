{% extends 'base.html' %}
{% load custom_filters %}

{% block content %}
<h1>Salas</h1>

<!-- Filter Form -->
<form method="GET">
    <label for="valencia">Valência:</label>
    <select name="valencia" id="valencia">
        <option value="">Todas as Valências</option>
        {% for valencia in valencias %}
        <option value="{{ valencia }}" {% if valencia == query_valencia %}selected{% endif %}>
            {{ valencia }}
        </option>
        {% endfor %}
    </select>

    <label for="room">Sala:</label>
    <select name="room" id="room">
        <option value="">Todas as Salas</option>
        {% for room in room_names %}
        <option value="{{ room }}" {% if room == query_room %}selected{% endif %}>
            {{ room }}
        </option>
        {% endfor %}
    </select>

    <button type="submit">Filtrar</button>
</form>

<!-- List of Rooms -->
<h2>Lista de Salas</h2>
<table style="width: 100%; border-collapse: collapse; text-align: left; font-family: Arial, sans-serif;">
    <thead>
        <tr style="background-color: #f2f2f2;">
            <th style="border: 1px solid #ddd; padding: 10px;">Valência</th>
            <th style="border: 1px solid #ddd; padding: 10px;">Sala</th>
        </tr>
    </thead>
    <tbody>
        {% for sala in salas %}
        <tr style="background-color: {% cycle '#ffffff' '#f9f9f9' %};">
            <td>{{ sala.sala_valencia }}</td>
            <td>{{ sala.sala_nome }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<!-- Assign Students to a Room -->
<h2>Atribuir Alunos a uma Sala</h2>
<form method="POST">
    {% csrf_token %}
    <label for="room_id">Selecionar Sala:</label>
    <select name="room_id" id="room_id">
        {% for sala in salas|dictsort:"sala_nome" %}
        <option value="{{ sala.id }}">{{ sala.sala_valencia }} - {{ sala.sala_nome }}</option>
        {% endfor %}
    </select>

    <h3>Selecionar Alunos:</h3>
    <div style="max-height: 200px; overflow-y: auto; border: 1px solid #ccc; padding: 10px;">
        {% for student in students %}
        <div>
            <input type="checkbox" name="students" value="{{ student.id }}" id="student_{{ student.id }}">
            <label for="student_{{ student.id }}">
                {{ student.nome_proprio }} {{ student.apelido }}
                {% if student.sala_id %}
                ({{ student.sala_id.sala_valencia }} - {{ student.sala_id.sala_nome }})
                {% else %}
                (Sem sala associada)
                {% endif %}
            </label>
        </div>
        {% endfor %}
    </div>

    <button type="submit" style="margin-top: 10px;">Atribuir</button>
</form>

{% endblock %}